{"ast":null,"code":"import _defineProperty from\"/home/bartekj/diet-planner/src/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _regeneratorRuntime from\"/home/bartekj/diet-planner/src/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/bartekj/diet-planner/src/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _extraReducers;import{createSlice,createAsyncThunk}from\"@reduxjs/toolkit\";import{setMessage}from\"./message\";import AuthService from\"../services/authService\";var user=JSON.parse(localStorage.getItem(\"user\"));export var register=createAsyncThunk(\"auth/register\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref,thunkAPI){var username,email,password,response,message;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:username=_ref.username,email=_ref.email,password=_ref.password;_context.prev=1;_context.next=4;return AuthService.register(username,email,password);case 4:response=_context.sent;thunkAPI.dispatch(setMessage(response.data.message));return _context.abrupt(\"return\",response.data);case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);message=_context.t0.response&&_context.t0.response.data&&_context.t0.response.data.message||_context.t0.message||_context.t0.toString();thunkAPI.dispatch(setMessage(message));return _context.abrupt(\"return\",thunkAPI.rejectWithValue());case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());export var login=createAsyncThunk(\"auth/login\",/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_ref3,thunkAPI){var username,password,data,message;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:username=_ref3.username,password=_ref3.password;_context2.prev=1;_context2.next=4;return AuthService.login(username,password);case 4:data=_context2.sent;return _context2.abrupt(\"return\",{user:data});case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](1);message=_context2.t0.response&&_context2.t0.response.data&&_context2.t0.response.data.message||_context2.t0.message||_context2.t0.toString();thunkAPI.dispatch(setMessage(message));return _context2.abrupt(\"return\",thunkAPI.rejectWithValue());case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,8]]);}));return function(_x3,_x4){return _ref4.apply(this,arguments);};}());export var logout=createAsyncThunk(\"auth/logout\",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return AuthService.logout();case 2:case\"end\":return _context3.stop();}}},_callee3);})));var initialState=user?{isLoggedIn:true,user:user}:{isLoggedIn:false,user:null};var authSlice=createSlice({name:\"auth\",initialState:initialState,extraReducers:(_extraReducers={},_defineProperty(_extraReducers,register.fulfilled,function(state,action){state.isLoggedIn=false;}),_defineProperty(_extraReducers,register.rejected,function(state,action){state.isLoggedIn=false;}),_defineProperty(_extraReducers,login.fulfilled,function(state,action){state.isLoggedIn=true;state.user=action.payload.user;}),_defineProperty(_extraReducers,login.rejected,function(state,action){state.isLoggedIn=false;state.user=null;}),_defineProperty(_extraReducers,logout.fulfilled,function(state,action){state.isLoggedIn=false;state.user=null;}),_extraReducers)});var reducer=authSlice.reducer;export default reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","setMessage","AuthService","user","JSON","parse","localStorage","getItem","register","thunkAPI","username","email","password","response","dispatch","data","message","toString","rejectWithValue","login","logout","initialState","isLoggedIn","authSlice","name","extraReducers","fulfilled","state","action","rejected","payload","reducer"],"sources":["/home/bartekj/diet-planner/src/frontend/src/slices/auth.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { setMessage } from \"./message\";\n\nimport AuthService from  \"../services/authService\";\n\nconst user = JSON.parse(localStorage.getItem(\"user\"));\n\nexport const register = createAsyncThunk(\n    \"auth/register\",\n    async ({ username, email, password}, thunkAPI) => {\n        try {\n            const response = await AuthService.register(username, email, password);\n            thunkAPI.dispatch(setMessage(response.data.message));\n            return response.data;\n        } catch (error) {\n            const message = (error.response && error.response.data && error.response.data.message)\n                || error.message\n                || error.toString();\n                thunkAPI.dispatch(setMessage(message));\n            return thunkAPI.rejectWithValue();\n        }\n    }\n)\n\nexport const login  = createAsyncThunk(\n    \"auth/login\",\n    async ({ username, password }, thunkAPI) => {\n        try {\n            const data = await AuthService.login(username, password);\n            return { user: data };\n        } catch (error) {\n            const message = (error.response && error.response.data && error.response.data.message) ||\n                error.message ||\n                error.toString();\n            thunkAPI.dispatch(setMessage(message));\n            return thunkAPI.rejectWithValue();\n        }\n    }\n)\n\nexport const logout = createAsyncThunk(\"auth/logout\", async () => {\n    await AuthService.logout();\n})\n\nconst initialState = user ? { isLoggedIn: true, user } : { isLoggedIn: false, user: null };\n\nconst authSlice = createSlice({\n    name: \"auth\",\n    initialState,\n    extraReducers: {\n        [register.fulfilled]: (state, action) => {\n            state.isLoggedIn = false;\n        },\n        [register.rejected]: (state, action) => {\n            state.isLoggedIn = false;\n        },\n        [login.fulfilled]: (state, action) => {\n            state.isLoggedIn = true;\n            state.user = action.payload.user;\n        },\n        [login.rejected]: (state, action) => {\n            state.isLoggedIn = false;\n            state.user = null;\n        },\n        [logout.fulfilled]: (state, action) => {\n            state.isLoggedIn = false;\n            state.user = null;\n        }\n    }\n})\n\nconst { reducer } = authSlice;\n\nexport default reducer;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}